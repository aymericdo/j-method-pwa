{"ast":null,"code":"import * as moment from 'moment';\nimport { ReplaySubject } from 'rxjs';\nimport { takeUntil, filter } from 'rxjs/operators';\nimport { setNotifications, shiftNotification } from '../store/current-session.actions';\nimport { select } from '@ngrx/store';\nimport { selectNotifications, selectIsOnPause } from '../store/current-session.reducer';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../notification.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@ngrx/store\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/button\";\nimport * as i6 from \"@angular/material/icon\";\nimport * as i7 from \"@angular/material/list\";\nfunction DailyScheduleComponent_ng_container_4_button_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function DailyScheduleComponent_ng_container_4_button_4_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r6.togglePauseMode());\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"pause_circle_filled\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction DailyScheduleComponent_ng_container_4_button_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function DailyScheduleComponent_ng_container_4_button_6_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r8.togglePauseMode());\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"play_circle_outline\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction DailyScheduleComponent_ng_container_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"span\", 6);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 7);\n    i0.ɵɵtemplate(4, DailyScheduleComponent_ng_container_4_button_4_Template, 3, 0, \"button\", 8);\n    i0.ɵɵpipe(5, \"async\");\n    i0.ɵɵtemplate(6, DailyScheduleComponent_ng_container_4_button_6_Template, 3, 0, \"button\", 9);\n    i0.ɵɵpipe(7, \"async\");\n    i0.ɵɵelementStart(8, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function DailyScheduleComponent_ng_container_4_Template_button_click_8_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.nextCourse());\n    });\n    i0.ɵɵelementStart(9, \"mat-icon\");\n    i0.ɵɵtext(10, \"skip_next\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.displayCountdown);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !i0.ɵɵpipeBind1(5, 3, ctx_r0.onPause$));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(7, 5, ctx_r0.onPause$));\n  }\n}\nfunction DailyScheduleComponent_ng_container_6_mat_list_item_2_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 16);\n  }\n  if (rf & 2) {\n    const ctx_r15 = i0.ɵɵnextContext(3);\n    i0.ɵɵstyleProp(\"width\", ctx_r15.percentageAccomplished);\n  }\n}\nfunction DailyScheduleComponent_ng_container_6_mat_list_item_2_span_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 16);\n  }\n  if (rf & 2) {\n    i0.ɵɵstyleProp(\"width\", \"100%\");\n  }\n}\nfunction DailyScheduleComponent_ng_container_6_mat_list_item_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-list-item\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, DailyScheduleComponent_ng_container_6_mat_list_item_2_span_2_Template, 1, 2, \"span\", 15);\n    i0.ɵɵtemplate(3, DailyScheduleComponent_ng_container_6_mat_list_item_2_span_3_Template, 1, 2, \"span\", 15);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const notif_r13 = ctx.$implicit;\n    const isFirst_r14 = ctx.first;\n    i0.ɵɵproperty(\"value\", notif_r13);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", notif_r13.course.name, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", isFirst_r14);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !isFirst_r14);\n  }\n}\nfunction DailyScheduleComponent_ng_container_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"mat-list\");\n    i0.ɵɵtemplate(2, DailyScheduleComponent_ng_container_6_mat_list_item_2_Template, 4, 4, \"mat-list-item\", 13);\n    i0.ɵɵpipe(3, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(3, 2, ctx_r1.notifications$))(\"ngForTrackBy\", ctx_r1.trackByMethod);\n  }\n}\nfunction DailyScheduleComponent_ng_template_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 17);\n    i0.ɵɵelement(1, \"img\", 18);\n    i0.ɵɵelementStart(2, \"h3\");\n    i0.ɵɵtext(3, \"Pas encore de notif enregistr\\u00E9e\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let DailyScheduleComponent = /*#__PURE__*/(() => {\n  var _class;\n  class DailyScheduleComponent {\n    constructor(notificationService, router, store) {\n      this.notificationService = notificationService;\n      this.router = router;\n      this.store = store;\n      this.countdown = 0;\n      this.destroyed$ = new ReplaySubject(1);\n    }\n    ngOnInit() {\n      this.notifications$ = this.store.pipe(select(selectNotifications));\n      this.onPause$ = this.store.pipe(select(selectIsOnPause));\n      this.notificationService.getNotifications().subscribe(notifications => {\n        this.store.dispatch(setNotifications({\n          notifications\n        }));\n      });\n      this.notifications$.pipe(filter(notifs => !!notifs.length), takeUntil(this.destroyed$)).subscribe(notifications => {\n        clearInterval(this.interval);\n        this.setCountdown(notifications);\n        this.setPercentageAccomplished(notifications);\n        this.notifications = notifications;\n        if (!notifications[0].isOnPauseSince) {\n          this.interval = setInterval(() => {\n            this.countdown -= 1;\n            this.setPercentageAccomplished(notifications);\n            if (this.countdown < 1) {\n              this.store.dispatch(shiftNotification());\n              if (notifications.length < 2) {\n                this.router.navigate(['/home']);\n              }\n            } else {\n              this.displayCountdown = new Date(this.countdown * 1000).toISOString().substr(11, 8);\n            }\n          }, 1000);\n        }\n      });\n    }\n    ngOnDestroy() {\n      clearInterval(this.interval);\n      this.destroyed$.next(true);\n      this.destroyed$.complete();\n    }\n    setPercentageAccomplished(notifications) {\n      const totalDurationInSeconds = notifications[0].durationBefore * 60;\n      this.percentageAccomplished = `${this.countdown * 100 / totalDurationInSeconds}%`;\n    }\n    setCountdown(notifications) {\n      if (notifications[0].isOnPauseSince) {\n        this.countdown = +moment(notifications[0].date).diff(moment(notifications[0].isOnPauseSince), 'second');\n      } else {\n        this.countdown = +moment(notifications[0].date).diff(moment(), 'second');\n      }\n      this.displayCountdown = new Date(this.countdown * 1000).toISOString().substr(11, 8);\n    }\n    togglePauseMode() {\n      this.notificationService.pauseNotifications().subscribe(notifications => {\n        this.store.dispatch(setNotifications({\n          notifications\n        }));\n      });\n    }\n    nextCourse() {\n      this.notificationService.deleteNotifications(this.notifications[0]._id).subscribe(notifications => {\n        this.store.dispatch(setNotifications({\n          notifications\n        }));\n      });\n    }\n    trackByMethod(index, el) {\n      return el._id;\n    }\n  }\n  _class = DailyScheduleComponent;\n  _class.ɵfac = function DailyScheduleComponent_Factory(t) {\n    return new (t || _class)(i0.ɵɵdirectiveInject(i1.NotificationService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.Store));\n  };\n  _class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _class,\n    selectors: [[\"app-daily-schedule\"]],\n    decls: 10,\n    vars: 5,\n    consts: [[\"mat-icon-button\", \"\", \"color\", \"primary\", \"aria-label\", \"Home button\", \"routerLink\", \"/home\", 1, \"fab-btn-back-button\"], [1, \"first-row\"], [4, \"ngIf\"], [1, \"second-row\"], [4, \"ngIf\", \"ngIfElse\"], [\"empty\", \"\"], [1, \"countdown\"], [1, \"buttons-section\"], [\"mat-mini-fab\", \"\", \"color\", \"primary\", \"class\", \"fab-btn-pause-button\", \"aria-label\", \"Toggle pause mode button\", 3, \"click\", 4, \"ngIf\"], [\"mat-mini-fab\", \"\", \"color\", \"primary\", \"class\", \"fab-btn-play-button\", \"aria-label\", \"Toggle play mode button\", 3, \"click\", 4, \"ngIf\"], [\"mat-mini-fab\", \"\", \"color\", \"primary\", \"aria-label\", \"Toggle next mode button\", 1, \"fab-btn-next-button\", 3, \"click\"], [\"mat-mini-fab\", \"\", \"color\", \"primary\", \"aria-label\", \"Toggle pause mode button\", 1, \"fab-btn-pause-button\", 3, \"click\"], [\"mat-mini-fab\", \"\", \"color\", \"primary\", \"aria-label\", \"Toggle play mode button\", 1, \"fab-btn-play-button\", 3, \"click\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [3, \"value\"], [\"class\", \"underliner\", 3, \"width\", 4, \"ngIf\"], [1, \"underliner\"], [1, \"empty-section\"], [\"src\", \"assets/no-data.svg\", 1, \"illustration\"]],\n    template: function DailyScheduleComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"button\", 0)(1, \"mat-icon\");\n        i0.ɵɵtext(2, \"keyboard_arrow_left\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(3, \"div\", 1);\n        i0.ɵɵtemplate(4, DailyScheduleComponent_ng_container_4_Template, 11, 7, \"ng-container\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"div\", 3);\n        i0.ɵɵtemplate(6, DailyScheduleComponent_ng_container_6_Template, 4, 4, \"ng-container\", 4);\n        i0.ɵɵpipe(7, \"async\");\n        i0.ɵɵtemplate(8, DailyScheduleComponent_ng_template_8_Template, 4, 0, \"ng-template\", null, 5, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        const _r2 = i0.ɵɵreference(9);\n        let tmp_1_0;\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", !!ctx.countdown);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", (tmp_1_0 = i0.ɵɵpipeBind1(7, 3, ctx.notifications$)) == null ? null : tmp_1_0.length)(\"ngIfElse\", _r2);\n      }\n    },\n    dependencies: [i2.RouterLink, i4.NgForOf, i4.NgIf, i5.MatIconButton, i5.MatMiniFabButton, i6.MatIcon, i7.MatList, i7.MatListItem, i4.AsyncPipe],\n    styles: [\"[_nghost-%COMP%]   .first-row[_ngcontent-%COMP%], [_nghost-%COMP%]   .second-row[_ngcontent-%COMP%]{height:50%;display:block}[_nghost-%COMP%]   .first-row[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;align-items:center;flex-direction:column}[_nghost-%COMP%]   .first-row[_ngcontent-%COMP%]   .countdown[_ngcontent-%COMP%]{color:#fff;font-size:2em}[_nghost-%COMP%]   .first-row[_ngcontent-%COMP%]   .buttons-section[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .first-row[_ngcontent-%COMP%]   .buttons-section[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:1em}[_nghost-%COMP%]   .empty-section[_ngcontent-%COMP%]{position:absolute;top:45%;left:50%;transform:translate(-50%,-50%)}[_nghost-%COMP%]   .illustration[_ngcontent-%COMP%]{display:block;height:200px}[_nghost-%COMP%]   h3[_ngcontent-%COMP%]{text-align:center;color:#fff}[_nghost-%COMP%]   .underliner[_ngcontent-%COMP%]{height:3px;width:100%;position:absolute;bottom:0;left:0;background:#c2185b}\"]\n  });\n  return DailyScheduleComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}